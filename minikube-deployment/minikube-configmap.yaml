apiVersion: v1
kind: ConfigMap
metadata:
  name: ecommerce-config
  namespace: ecommerce
  labels:
    app: ecommerce
data:
  # Eureka Configuration
  EUREKA_CLIENT_AVAILABILITYZONES_DEFAULT: myzone
  EUREKA_CLIENT_REGION: default
  EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://service-discovery:8761/eureka/
  EUREKA_CLIENT_SERVICEURL_MYZONE: http://service-discovery:8761/eureka
  
  # Logging Configuration
  LOGGING_LEVEL_COM_ECOMMERCE: DEBUG
  LOGGING_LEVEL_ROOT: INFO
  
  # Server Configuration
  SERVER_COMPRESSION_ENABLED: "true"
  
  # Spring Configuration (Embedded - No Cloud Config)
  SPRING_PROFILES_ACTIVE: dev
  SPRING_CLOUD_CONFIG_ENABLED: "false"
  
  # Database Configuration (H2 for Minikube testing)
  SPRING_DATASOURCE_DRIVER_CLASS_NAME: org.h2.Driver
  SPRING_DATASOURCE_URL: jdbc:h2:mem:testdb
  SPRING_DATASOURCE_USERNAME: sa
  SPRING_DATASOURCE_PASSWORD: ""
  SPRING_JPA_HIBERNATE_DDL_AUTO: create-drop
  SPRING_JPA_SHOW_SQL: "true"
  SPRING_H2_CONSOLE_ENABLED: "true"
  
  # Web Configuration
  SPRING_MVC_THROW_EXCEPTION_IF_NO_HANDLER_FOUND: "true"
  SPRING_WEB_RESOURCES_ADD_MAPPINGS: "false"
  
  # Zipkin Configuration (optional for Minikube)
  SPRING_ZIPKIN_BASE_URL: http://zipkin:9411
  
  # Microservices Configuration
  MICROSERVICE_TIMEOUT: "30000"
  MICROSERVICE_RETRY_ATTEMPTS: "3"
  MICROSERVICE_CIRCUIT_BREAKER_ENABLED: "true"
  
  # API Gateway Configuration
  SPRING_CLOUD_GATEWAY_DISCOVERY_LOCATOR_ENABLED: "true"
  SPRING_CLOUD_GATEWAY_DISCOVERY_LOCATOR_LOWERCASE_SERVICE_ID: "true"
  SPRING_CLOUD_GATEWAY_DISCOVERY_LOCATOR_ROUTES_PREDICATE_PATH: "/{serviceId}/**"
  SPRING_CLOUD_GATEWAY_DISCOVERY_LOCATOR_ROUTES_FILTERS_0_NAME: "RewritePath"
  SPRING_CLOUD_GATEWAY_DISCOVERY_LOCATOR_ROUTES_FILTERS_0_ARGS_REGEX: "/{serviceId}/(?<remaining>.*)"
  SPRING_CLOUD_GATEWAY_DISCOVERY_LOCATOR_ROUTES_FILTERS_0_ARGS_REPLACEMENT: "/${remaining}"
  
  # Circuit Breaker Configuration
  RESILIENCE4J_CIRCUITBREAKER_INSTANCES_DEFAULT_SLIDING_WINDOW_SIZE: "10"
  RESILIENCE4J_CIRCUITBREAKER_INSTANCES_DEFAULT_MINIMUM_NUMBER_OF_CALLS: "5"
  RESILIENCE4J_CIRCUITBREAKER_INSTANCES_DEFAULT_FAILURE_RATE_THRESHOLD: "50"
  RESILIENCE4J_CIRCUITBREAKER_INSTANCES_DEFAULT_WAIT_DURATION_IN_OPEN_STATE: "10s"
  RESILIENCE4J_CIRCUITBREAKER_INSTANCES_DEFAULT_PERMITTED_NUMBER_OF_CALLS_IN_HALF_OPEN_STATE: "3"
  
  # Retry Configuration
  RESILIENCE4J_RETRY_INSTANCES_DEFAULT_MAX_ATTEMPTS: "3"
  RESILIENCE4J_RETRY_INSTANCES_DEFAULT_WAIT_DURATION: "1s"
  RESILIENCE4J_RETRY_INSTANCES_DEFAULT_ENABLE_EXPONENTIAL_BACKOFF: "true"
  RESILIENCE4J_RETRY_INSTANCES_DEFAULT_EXPONENTIAL_BACKOFF_MULTIPLIER: "2"
  
  # Timeout Configuration
  RESILIENCE4J_TIMELIMITER_INSTANCES_DEFAULT_TIMEOUT_DURATION: "4s"
